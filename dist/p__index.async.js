"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[866],{38139:function(pe,R,e){e.r(R),e.d(R,{default:function(){return ye}});var K=e(93525),P=e.n(K),J=e(25359),r=e.n(J),Q=e(57213),z=e.n(Q),W=e(54689),A=e.n(W),X=e(49811),v=e.n(X),x=e(54306),D=e.n(x),$=e(93236),q=e(7123),_=e(14945),U=e(69013),F=e(73339),E=e(82026),ee=e(41570),L=e(55479),G=e(37566),w=e(18127),B=e(59703),T=e(20402),I={getTaskById:function(){var l=v()(r()().mark(function t(a){return r()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",S.get("/mj-api/mj/task/".concat(a,"/fetch")));case 1:case"end":return i.stop()}},t)}));function C(t){return l.apply(this,arguments)}return C}(),getTaskByIds:function(){var l=v()(r()().mark(function t(a){return r()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",S.jsonPost("/mj-api/mj/task/list-by-condition",a));case 1:case"end":return i.stop()}},t)}));function C(t){return l.apply(this,arguments)}return C}(),submit:{imagine:function(){var l=v()(r()().mark(function t(a){return r()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",S.jsonPost("/mj-api/mj/submit/imagine",a));case 1:case"end":return i.stop()}},t)}));function C(t){return l.apply(this,arguments)}return C}(),change:function(){var l=v()(r()().mark(function t(a){return r()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",S.jsonPost("/mj-api/mj/submit/change",a));case 1:case"end":return i.stop()}},t)}));function C(t){return l.apply(this,arguments)}return C}()}},O=function(l){return l[l.\u63D0\u4EA4\u6210\u529F=1]="\u63D0\u4EA4\u6210\u529F",l[l.\u5DF2\u5B58\u5728=2]="\u5DF2\u5B58\u5728",l[l.\u6392\u961F\u4E2D=22]="\u6392\u961F\u4E2D",l}({}),S={get:function(){var l=v()(r()().mark(function t(a,k){return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,T.request)(a,{method:"GET",params:k}));case 1:case"end":return h.stop()}},t)}));function C(t,a){return l.apply(this,arguments)}return C}(),jsonPost:function(){var l=v()(r()().mark(function t(a,k){return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,T.request)(a,{method:"POST",headers:{"Content-Type":"application/json"},data:k}));case 1:case"end":return h.stop()}},t)}));function C(t,a){return l.apply(this,arguments)}return C}(),formPost:function(){var l=v()(r()().mark(function t(a,k){var i,h,b;return r()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:i=new FormData;for(h in k)Object.prototype.hasOwnProperty.call(k,h)&&(b=k[h],h==="files"?b.forEach(function(ne){i.append("file",ne)}):i.append(h,b));return Z.abrupt("return",(0,T.request)(a,{method:"POST",requestType:"form",data:i}));case 3:case"end":return Z.stop()}},t)}));function C(t,a){return l.apply(this,arguments)}return C}()},re=e(21140),m=e.n(re),me=e(63466),le=e.n(me),ve=function(){function l(){m()(this,l)}return le()(l,null,[{key:"timestampToTime",value:function(t){var a=new Date(t),k=a.getFullYear()+"-",i=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",h=(a.getDate()<10?"0"+a.getDate():a.getDate())+" ",b=(a.getHours()<10?"0"+a.getHours():a.getHours())+":",N=(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())+":",Z=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return k+i+h+b+N+Z}}]),l}(),ce=e(22190),he=function(){function l(){m()(this,l)}return le()(l,null,[{key:"copyProperties",value:function(t,a){for(var k=0,i=Object.keys(t);k<i.length;k++){var h=i[k];a[h]=t[h]}}}]),l}(),ge={taskIsFinish:function(C){var t=C.status;return t==="SUCCESS"||t==="FAILURE"},form:{prompt:""}},f=e(62086),H=ge;function ye(){var l=(0,q.Z)("mj-task-list",{defaultValue:[]}),C=D()(l,2),t=C[0],a=C[1],k=(0,$.useState)([]),i=D()(k,2),h=i[0],b=i[1],N=(0,$.useState)(!1),Z=D()(N,2),ne=Z[0],je=Z[1],Ie=(0,$.useState)(),oe=D()(Ie,2),De=oe[0],$e=oe[1],Ce=(0,$.useState)(!1),de=D()(Ce,2),Se=de[0],M=de[1];(0,$.useEffect)(function(){if(t!=null&&t.length){var s=function(){var u=v()(r()().mark(function n(){var d,c,o,g,p,y,Y;return r()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:d=[],c=A()(t),j.prev=2,c.s();case 4:if((o=c.n()).done){j.next=23;break}return g=o.value,p=z()({},g),d.push(p),j.next=10,ce.C.mjImage.findById(g.id);case 10:if(y=j.sent,!y){j.next=15;break}p.imageBlob=y.image,j.next=21;break;case 15:if(!(g.status==="SUCCESS"&&g.imageUrl)){j.next=21;break}return console.log("\u4E0B\u8F7D\u56FE\u7247\uFF1A",g.imageUrl),j.next=19,ce.C.mjImage.add(g.id,g.imageUrl);case 19:Y=j.sent,p.imageBlob=Y;case 21:j.next=4;break;case 23:j.next=28;break;case 25:j.prev=25,j.t0=j.catch(2),c.e(j.t0);case 28:return j.prev=28,c.f(),j.finish(28);case 31:return j.abrupt("return",d);case 32:case"end":return j.stop()}},n,null,[[2,25,28,31]])}));return function(){return u.apply(this,arguments)}}();s().then(function(u){return b(u)})}},[t]),(0,_.Z)(v()(r()().mark(function s(){return r()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:case"end":return n.stop()}},s)})));function ke(){return ae.apply(this,arguments)}function ae(){return ae=v()(r()().mark(function s(){return r()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:V(v()(r()().mark(function d(){return r()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,I.submit.imagine(H.form);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}},d)})));case 1:case"end":return n.stop()}},s)})),ae.apply(this,arguments)}function Te(s,u){return te.apply(this,arguments)}function te(){return te=v()(r()().mark(function s(u,n){return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:V(v()(r()().mark(function o(){return r()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,I.submit.change({action:"UPSCALE",taskId:u,index:n});case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},o)})));case 1:case"end":return c.stop()}},s)})),te.apply(this,arguments)}function we(s,u){return se.apply(this,arguments)}function se(){return se=v()(r()().mark(function s(u,n){return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:V(v()(r()().mark(function o(){return r()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,I.submit.change({action:"VARIATION",taskId:u,index:n});case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},o)})));case 1:case"end":return c.stop()}},s)})),se.apply(this,arguments)}function fe(s,u){return ue.apply(this,arguments)}function ue(){return ue=v()(r()().mark(function s(u,n){return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:V(v()(r()().mark(function o(){return r()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,I.submit.change({action:"ZOOM",taskId:u,zoomArg:n});case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},o)})));case 1:case"end":return c.stop()}},s)})),ue.apply(this,arguments)}function V(s){return ie.apply(this,arguments)}function ie(){return ie=v()(r()().mark(function s(u){var n,d,c,o,g;return r()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return U.ZP.info("\u4EFB\u52A1\u63D0\u4EA4\u4E2D..."),M(!0),y.next=4,u();case 4:if(n=y.sent,d=n.code,c=n.result,o=n.description,d===O.\u63D0\u4EA4\u6210\u529F){y.next=12;break}return M(!1),U.ZP.error(o),y.abrupt("return");case 12:return y.next=14,I.getTaskById(c);case 14:if(g=y.sent,M(!1),g){y.next=19;break}return U.ZP.error("\u83B7\u53D6\u4EFB\u52A1\u5931\u8D25"),y.abrupt("return");case 19:U.ZP.success("\u4EFB\u52A1\u6267\u884C\u4E2D..."),a([g].concat(P()(t)));case 21:case"end":return y.stop()}},s)})),ie.apply(this,arguments)}function Pe(s){if(!H.taskIsFinish(s))return null;var u=s.id,n=s.action;return n==="UPSCALE"?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(F.ZP,{onClick:function(){fe(u,"75")},children:"Zoom 1.5x"}),(0,f.jsx)(F.ZP,{onClick:function(){fe(u,"50")},children:"Zoom 2x"})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(E.Z.Compact,{direction:"vertical",children:Be(u)}),(0,f.jsx)(E.Z.Compact,{direction:"vertical",children:Ze(u)})]})}function Be(s){for(var u=[],n=function(o){u.push((0,f.jsxs)(F.ZP,{onClick:function(){Te(s,o)},children:["\u653E\u5927",o]},o))},d=1;d<=4;d++)n(d);return u}function Ze(s){for(var u=[],n=function(o){u.push((0,f.jsxs)(F.ZP,{onClick:function(){we(s,o)},children:["\u53D8\u6362",o]},o))},d=1;d<=4;d++)n(d);return u}function Fe(s){var u=s.id;return H.taskIsFinish(s)?null:(0,f.jsx)(F.ZP,{onClick:v()(r()().mark(function n(){var d,c,o,g;return r()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return M(!0),y.next=3,I.getTaskById(u);case 3:d=y.sent,console.log("\u5237\u65B0\u4EFB\u52A1\uFF1A",d),c=A()(t);try{for(c.s();!(o=c.n()).done;)g=o.value,g.id===d.id&&he.copyProperties(d,g)}catch(Y){c.e(Y)}finally{c.f()}a(P()(t)),M(!1);case 9:case"end":return y.stop()}},n)})),children:"\u5237\u65B0"})}return(0,f.jsxs)("div",{children:[(0,f.jsxs)(E.Z.Compact,{style:{width:"100%"},children:[(0,f.jsx)(ee.Z,{placeholder:"\u8BF7\u8F93\u5165\u82F1\u6587\u63D0\u793A\u8BED",onChange:function(u){H.form.prompt=u.currentTarget.value}}),(0,f.jsx)(F.ZP,{type:"primary",onClick:ke,children:"\u5F00\u59CB\u4F5C\u56FE"})]}),(0,f.jsx)(L.Z,{rowKey:"id",loading:Se,bordered:!0,dataSource:h,columns:[{title:"\u56FE\u7247",render:function(u,n){var d=n.status,c=n.imageUrl;if(d==="IN_PROGRESS"&&c)return(0,f.jsx)(G.Z,{width:200,src:c});var o=n.imageBlob?window.URL.createObjectURL(n.imageBlob):null;return(0,f.jsx)("div",{children:o?(0,f.jsx)(G.Z,{width:200,src:o}):null})}},{title:"\u4EFB\u52A1id",render:function(u,n){return(0,f.jsx)(w.Z,{onClick:function(){},children:(0,f.jsx)("a",{children:n.id})})}},{title:"\u52A8\u4F5C",dataIndex:"action"},{title:"\u63CF\u8FF0\u8BCD",dataIndex:"prompt"},{title:"\u63D0\u4EA4\u65F6\u95F4",render:function(u,n){return(0,f.jsx)("span",{children:ve.timestampToTime(n.submitTime)})}},{title:"\u8FDB\u5EA6",dataIndex:"progress"},{title:"\u72B6\u6001",dataIndex:"status"},{title:"\u64CD\u4F5C",render:function(u,n){return(0,f.jsxs)(E.Z,{size:"small",children:[Fe(n),Pe(n)]})}}]}),(0,f.jsxs)(B.Z,{title:"Basic Modal",open:ne,onOk:function(){},onCancel:function(){je(!1)},children:[(0,f.jsx)("p",{children:"Some contents..."}),(0,f.jsx)("p",{children:"Some contents..."}),(0,f.jsx)("p",{children:"Some contents..."})]})]})}},22190:function(pe,R,e){e.d(R,{C:function(){return G},db:function(){return L}});var K=e(25359),P=e.n(K),J=e(49811),r=e.n(J),Q=e(63466),z=e.n(Q),W=e(21140),A=e.n(W),X=e(68608),v=e.n(X),x=e(58853),D=e.n(x),$=e(38888),q=e.n($),_=e(52510),U=e.n(_),F=function(){function w(){A()(this,w)}return z()(w,null,[{key:"download",value:function(){var B=r()(P()().mark(function I(O){var S;return P()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.prev=0,m.next=3,window.fetch(O);case 3:return S=m.sent,m.next=6,S.blob();case 6:return m.abrupt("return",m.sent);case 9:return m.prev=9,m.t0=m.catch(0),m.abrupt("return",null);case 12:case"end":return m.stop()}},I,null,[[0,9]])}));function T(I){return B.apply(this,arguments)}return T}()}]),w}(),E=e(4635),ee=function(w){D()(T,w);var B=q()(T);function T(){var I;return A()(this,T),I=B.call(this,"arthold"),U()(v()(I),"friends",void 0),U()(v()(I),"mjImage",void 0),I.version(4).stores({friends:"name, age",mjImage:"taskId"}),I}return z()(T)}(E.default),L=new ee,G={mjImage:{add:function(){var w=r()(P()().mark(function T(I,O){var S;return P()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,F.download(O);case 2:if(S=m.sent,S){m.next=5;break}return m.abrupt("return",void 0);case 5:return m.next=7,L.mjImage.add({taskId:I,image:S});case 7:return m.abrupt("return",S);case 8:case"end":return m.stop()}},T)}));function B(T,I){return w.apply(this,arguments)}return B}(),findById:function(){var w=r()(P()().mark(function T(I){return P()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,L.mjImage.get(I);case 2:return S.abrupt("return",S.sent);case 3:case"end":return S.stop()}},T)}));function B(T){return w.apply(this,arguments)}return B}()}}}}]);
